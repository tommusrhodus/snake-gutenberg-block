(()=>{"use strict";const e=window.wp.blocks,o=window.wp.i18n,t=window.wp.blockEditor,s=window.wp.element,a=window.wp.components,n=window.ReactJSXRuntime,i=JSON.parse('{"UU":"tommusrhodus/snake-game-block"}');(0,e.registerBlockType)(i.UU,{edit:function({attributes:e,setAttributes:i,isSelected:r}){const{snakeColor:l,appleColor:p,startSnakeSize:h,refreshRate:d,backgroundColor:c,highScore:k}=e,[m]=(0,t.useSettings)("layout.contentSize")||"800px",g=parseInt(m.replace("px","")),[u,w]=(0,s.useState)({width:0,height:0,blockWidth:0,blockHeight:0,gameLoopTimeout:d,timeoutId:0,snake:[],apple:{},direction:"right",directionChanged:!1,isGameOver:!0,score:0,highScore:k}),[f,b]=(0,s.useState)(0);(0,s.useEffect)((()=>{x()}),[]),(0,s.useEffect)((()=>{C()}),[f]),(0,s.useEffect)((()=>{r?(window.removeEventListener("keydown",H),window.addEventListener("keydown",H),C()):(window.removeEventListener("keydown",H),clearTimeout(u.timeoutId))}),[r]);const x=()=>{const e=g,o=e/3*2,t=e/30,s=t,a=[];let n=e/2;const i=o/2,r={Xpos:e/2,Ypos:o/2};a.push(r);for(let e=1;e<h;e++){n-=t;const e={Xpos:n,Ypos:i};a.push(e)}const l=Math.floor(Math.random()*((e-t)/t+1))*t;let p=Math.floor(Math.random()*((o-s)/s+1))*s;for(;p===a[0].Ypos;)p=Math.floor(Math.random()*((o-s)/s+1))*s;w((n=>({...n,width:e,height:o,blockWidth:t,blockHeight:s,startSnakeSize:h,snake:a,apple:{Xpos:l,Ypos:p}})))},C=()=>{const e=setTimeout((()=>{!u.isGameOver&&u.snake.length>0&&(X(),v(),Y(),w((e=>({...e,directionChanged:!1})))),b(f+1)}),u.gameLoopTimeout);w((o=>({...o,timeoutId:e})))},X=()=>{const e=[...u.snake];let o=u.snake[0].Xpos,t=u.snake[0].Ypos,s=o,a=t;M();for(let n=1;n<e.length;n++)s=e[n].Xpos,a=e[n].Ypos,e[n].Xpos=o,e[n].Ypos=t,o=s,t=a;w((o=>({...o,snake:e})))},Y=()=>{const e=u.snake,o=u.apple;if(e[0].Xpos===o.Xpos&&e[0].Ypos===o.Ypos){const t=u.width,s=u.height,a=u.blockWidth,n=u.blockHeight,r={Xpos:o.Xpos,Ypos:o.Ypos};let l=u.highScore,p=u.gameLoopTimeout;for(e.push(r),o.Xpos=Math.floor(Math.random()*((t-a)/a+1))*a,o.Ypos=Math.floor(Math.random()*((s-n)/n+1))*n;S(o.Xpos,o.Ypos);)o.Xpos=Math.floor(Math.random()*((t-a)/a+1))*a,o.Ypos=Math.floor(Math.random()*((s-n)/n+1))*n;u.score===l&&(l++,i({highScore:l})),p>25&&(p-=.5),w((t=>({...t,snake:e,apple:o,score:u.score+1,highScore:l,gameLoopTimeout:p})))}},v=()=>{const e=u.snake;for(let o=1;o<e.length;o++)e[0].Xpos===e[o].Xpos&&e[0].Ypos===e[o].Ypos&&w((e=>({...e,isGameOver:!0})))},S=(e,o)=>{const t=u.snake;for(let s=0;s<t.length;s++)if(e===t[s].Xpos&&o===t[s].Ypos)return!0;return!1},M=()=>{switch(u.direction){case"left":j(u.width,u.blockWidth,u.snake);break;case"up":y(u.height,u.blockHeight,u.snake);break;case"right":E(u.width,u.blockWidth,u.snake);break;default:G(u.height,u.blockHeight,u.snake)}},j=(e,o,t)=>{t[0].Xpos=t[0].Xpos<=0?e-o:t[0].Xpos-o,w((e=>({...e,snake:t})))},y=(e,o,t)=>{t[0].Ypos=t[0].Ypos<=0?e-o:t[0].Ypos-o,w((e=>({...e,snake:t})))},E=(e,o,t)=>{t[0].Xpos=t[0].Xpos>=e-o?0:t[0].Xpos+o,w((e=>({...e,snake:t})))},G=(e,o,t)=>{t[0].Ypos=t[0].Ypos>=e-o?0:t[0].Ypos+o,w((e=>({...e,snake:t})))},H=e=>{u.directionChanged||w((o=>{let t=o.direction;switch(e.keyCode){case 65:"right"!==o.direction&&(t="left");break;case 87:"down"!==o.direction&&(t="up");break;case 68:"left"!==o.direction&&(t="right");break;case 83:"up"!==o.direction&&(t="down");break;default:return o}return{...o,direction:t,directionChanged:!0}}))};return(0,n.jsxs)("div",{...(0,t.useBlockProps)(),children:[(0,n.jsx)(t.InspectorControls,{children:(0,n.jsxs)(a.PanelBody,{title:(0,o.__)("Game Settings","text-domain"),initialOpen:!0,children:[(0,n.jsx)(t.ColorPaletteControl,{value:c,onChange:e=>i({backgroundColor:e}),label:(0,o.__)("Background Color","text-domain")}),(0,n.jsx)(t.ColorPaletteControl,{value:l,onChange:e=>i({snakeColor:e}),label:(0,o.__)("Snake Color","text-domain")}),(0,n.jsx)(t.ColorPaletteControl,{value:p,onChange:e=>i({appleColor:e}),label:(0,o.__)("Apple Color","text-domain")}),(0,n.jsx)(a.RangeControl,{label:(0,o.__)("Game Speed(ms)","text-domain"),value:d,onChange:e=>i({refreshRate:e}),min:20,max:200,step:10})]})}),(0,n.jsx)("div",{id:"GameBoard",style:{"--game-width":u.width+"px","--game-height":u.height+"px","--snake-color":l,"--apple-color":p,"--background-color":c},children:u.isGameOver?(0,n.jsx)("div",{id:"GameOver",children:(0,n.jsx)("div",{id:"PressSpaceText",children:(0,n.jsx)(a.Button,{variant:"primary",onClick:()=>{window.removeEventListener("keydown",H),window.addEventListener("keydown",H);const e=u.width,o=u.height,t=u.blockWidth,s=u.blockHeight,a=u.apple,n=[];let i=e/2;const r=o/2,l={Xpos:e/2,Ypos:o/2};n.push(l);for(let e=1;e<u.startSnakeSize;e++){i-=t;const e={Xpos:i,Ypos:r};n.push(e)}for(a.Xpos=Math.floor(Math.random()*((e-t)/t+1))*t,a.Ypos=Math.floor(Math.random()*((o-s)/s+1))*s;S(a.Xpos,a.Ypos);)a.Xpos=Math.floor(Math.random()*((e-t)/t+1))*t,a.Ypos=Math.floor(Math.random()*((o-s)/s+1))*s;w((e=>({...e,snake:n,apple:a,direction:"right",directionChanged:!1,isGameOver:!1,gameLoopTimeout:d,score:0})))},text:"Start Game"})})}):(0,n.jsxs)(n.Fragment,{children:[u.snake.map(((e,o)=>(0,n.jsx)("div",{className:"snake",style:{width:u.blockWidth,height:u.blockHeight,left:e.Xpos,top:e.Ypos}},o))),(0,n.jsx)("div",{className:"apple",style:{width:u.blockWidth,height:u.blockHeight,left:u.apple.Xpos,top:u.apple.Ypos}}),!r&&(0,n.jsx)("div",{id:"paused",children:"Paused"})]})}),r&&(0,n.jsxs)("div",{id:"score",children:[(0,n.jsxs)("span",{children:["HIGH-SCORE: ",u.highScore]}),(0,n.jsxs)("span",{children:["SCORE: ",u.score]})]})]})}})})();